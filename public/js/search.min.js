document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelectorAll(".js-search-toggle"),i=document.getElementById("search-toggle"),a=o.length?Array.from(o):i?[i]:[],r=document.getElementById("search-close"),e=document.getElementById("search-modal"),t=document.getElementById("search-input"),n=document.getElementById("search-results");let s=null;if(a.length&&e&&r){const s=()=>{e.classList.remove("hidden"),setTimeout(()=>{e.classList.remove("opacity-0"),t&&(t.focus(),c())},10)};a.forEach(e=>{e.addEventListener("click",s)});const n=()=>{e.classList.add("opacity-0"),setTimeout(()=>{e.classList.add("hidden")},300)};r.addEventListener("click",n),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&n()})}async function c(){if(s)return;try{const e=await fetch("/index.json"),t=await e.json();s=t.posts}catch(e){console.error("Failed to load search index",e)}}t&&n&&t.addEventListener("input",e=>{const t=e.target.value.toLowerCase();if(!t){n.innerHTML='<p class="text-center text-gray-500 mt-8">記事を検索できます。</p>';return}if(!s)return;const o=s.filter(e=>{const n=e.title?e.title.toLowerCase():"",s=e.summary?e.summary.toLowerCase():"",o=e.content?e.content.toLowerCase():"",i=e.tags?e.tags.join(" ").toLowerCase():"";return n.includes(t)||s.includes(t)||o.includes(t)||i.includes(t)});l(o)});function l(e){if(e.length===0){n.innerHTML='<p class="text-center text-gray-500 mt-8">見つかりませんでした。</p>';return}const t=e.map(e=>`
            <a href="${e.url}" class="block p-4 mb-4 hover:bg-gray-100 dark:hover:bg-white/5 rounded-lg transition-colors">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-1">${e.title}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${e.summary||(e.content?e.content.substring(0,100):"")}...</p>
                <div class="flex gap-2 mt-2">
                    ${e.tags?e.tags.map(e=>`<span class="text-xs bg-gray-200 dark:bg-white/10 px-2 py-1 rounded text-gray-600 dark:text-gray-400">#${e}</span>`).join(""):""}
                </div>
            </a>
        `).join("");n.innerHTML=t}})