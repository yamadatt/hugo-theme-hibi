# hugo-theme-hibi 保守性改善調査レポート

**調査日**: 2026年1月21日
**対象**: hugo-theme-hibi テーマ
**総評**: 機能的には良好だが、コード重複と設定散在により保守性は**中リスク**レベル

---

## 概要

現在のコードベースは約1,973行で、モダンなHugoテーマとして基本的な設計は良好です。しかし、**コードの重複**と**モジュール化の不足**が保守性を低下させています。今後の運用を考えると、以下の改善が推奨されます。

---

## 1. 高優先度の改善点

### 1.1 テンプレートの重複問題

#### ポストカードのレンダリングロジック（3箇所で重複）

**該当箇所**:
- `layouts/index.html:11-25` - ホームページ
- `layouts/_default/list.html:9-15` - タグ一覧
- `layouts/_default/term.html:9-15` - 個別タグ

**問題**: 同じカード描画ロジックが3箇所に存在し、デザイン変更時に3箇所の編集が必要

**改善案**:
```html
{{/* layouts/partials/post-list.html として統合 */}}
{{ $paginator := .Paginate (where .Site.RegularPages "Section" "posts") }}
{{ range $paginator.Pages }}
  {{ partial "post-card.html" (dict "Page" . "Site" $.Site ...) }}
{{ end }}
{{ partial "pagination.html" (dict "Paginator" $paginator) }}
```

#### ページネーションの重複（3箇所）

**該当箇所**:
- `layouts/index.html:26-27`
- `layouts/_default/list.html:16-17`
- `layouts/_default/term.html:16-17`

**改善案**: ポストリストと一緒にパーシャルに統合

#### 画像取得ロジックの重複（4箇所）

**該当箇所**:
- `layouts/_default/single.html:5`
- `layouts/_default/archive.html:50`
- `layouts/partials/post-card.html:16-22`
- `layouts/partials/post-card-compact.html:14-20`

**問題**: featuredImagePreview → featuredImage のフォールバック処理が散在

**改善案**: 画像取得用のヘルパーパーシャルを作成
```html
{{/* layouts/partials/helpers/get-featured-image.html */}}
{{ $image := "" }}
{{ with .Resources.GetMatch .Params.featuredImagePreview }}
  {{ $image = . }}
{{ else }}
  {{ with .Resources.GetMatch .Params.featuredImage }}
    {{ $image = . }}
  {{ end }}
{{ end }}
{{ return $image }}
```

---

### 1.2 設定ファイルの問題

#### 重複する設定キー

**config.yaml の問題**:
```yaml
summaryLength: 100              # 4行目
params:
  summaryTruncateLength: 0      # 25行目（重複・不使用）
```

**改善案**: `summaryTruncateLength` を削除し、`summaryLength` に統一

#### 未使用・不整合な設定

| 設定 | 状況 | 対応 |
|------|------|------|
| `tagFallbackLabel: 日常` | 一部のテンプレートでのみ使用 | 全テンプレートで統一使用 |
| `theme: []` | 空配列 | 削除または適切な値を設定 |

---

### 1.3 ハードコードされた値の設定化

#### 画像サイズ（テンプレートごとにバラバラ）

| 現在の値 | 場所 |
|---------|------|
| `640x webp q80` | list.html |
| `300x webp q80` | post-card-compact.html |
| `1280x webp q85` | single.html |
| `800x webp q80` | index.html |

**改善案**: config.yaml で一元管理
```yaml
params:
  images:
    card: "640x webp q80"
    cardCompact: "300x webp q80"
    single: "1280x webp q85"
    ogp: "1200x630 center"
```

#### タグのフォールバックラベル（不整合）

- `index.html`: "日常"
- `list.html`: "Uncategorized"
- `term.html`: "Uncategorized"

**改善案**: `site.Params.tagFallbackLabel` を全テンプレートで統一使用

---

## 2. 中優先度の改善点

### 2.1 ビルド成果物の管理

**問題**: `resources/_gen/` と `public/` がリポジトリにコミットされている

**改善案**: `.gitignore` に追加
```gitignore
public/
resources/_gen/
```

### 2.2 ドキュメントの整備

**欠落しているファイル**:

| ファイル | 目的 | 優先度 |
|---------|------|--------|
| `README.md` | セットアップ・使用方法 | 高 |
| `theme.toml` | Hugoテーマメタデータ | 高 |
| `CONTRIBUTING.md` | 貢献ガイドライン | 中 |
| `CHANGELOG.md` | 変更履歴 | 中 |

### 2.3 archive.htmlのパフォーマンス

**問題**: 同じファイル内で `GroupByDate` が3回呼ばれている（24行目、30行目、40行目）

**改善案**: 変数に一度だけ格納して再利用
```html
{{ $years := (where .Site.RegularPages "Section" "posts").GroupByDate "2006" }}
{{/* 以降は $years を使い回す */}}
```

### 2.4 未使用のi18nディレクトリ

**状況**: `i18n/` ディレクトリが存在するが空

**選択肢**:
1. 国際化対応を実装する（将来的な多言語対応）
2. ディレクトリを削除する（シンプル化）

**ハードコードされた日本語**:
- "日々"（テーマタイトル）
- "続きを読む"（Read moreリンク）
- "記事を検索できます。"（検索UI）
- "見つかりませんでした。"（検索結果なし）

---

## 3. 低優先度の改善点

### 3.1 JavaScript のレガシーコード

**search.js の問題**:
```javascript
// レガシー対応のための重複したDOM取得
const searchToggleButtons = document.querySelectorAll('.js-search-toggle');
const legacySearchToggle = document.getElementById('search-toggle');
```

**改善案**: レガシーコードパスを削除し、統一されたセレクタを使用

### 3.2 パーシャルのパラメータ命名規則

**現状の不整合**:
- `ImageSize` (PascalCase)
- `DateFormat` (PascalCase)
- `SummaryTruncate` (PascalCase)

**改善案**: 一貫した命名規則を採用（例: すべてcamelCaseまたはPascalCase）

### 3.3 CSSの改善

**ハードコードされた色**:
```css
text-[#2c2c2c] dark:text-[#e0e0e0]
background-color: rgba(62, 92, 92, 0.03)
```

**改善案**: CSS変数に統一
```css
:root {
  --text-primary: #2c2c2c;
  --text-primary-dark: #e0e0e0;
}
```

---

## 4. 推奨アクションプラン

### フェーズ1: クイックウィン（2-3時間）

1. `.gitignore` に `public/` と `resources/_gen/` を追加
2. `summaryTruncateLength` 設定を削除
3. 基本的な `theme.toml` を作成
4. タグフォールバックラベルを全テンプレートで統一

### フェーズ2: 構造改善（6-8時間）

1. ポストリスト用のヘルパーパーシャルを作成
2. 画像サイズを `config.yaml` で一元管理
3. 画像取得ヘルパーパーシャルを作成
4. archive.html の `GroupByDate` を最適化

### フェーズ3: ドキュメント整備（4-5時間）

1. `README.md` を作成
2. `CONTRIBUTING.md` を作成
3. パーシャルテンプレートのAPIドキュメント化

### フェーズ4: 国際化対応の判断（3-6時間）

- i18n インフラを活用するか、削除するかを決定

---

## 5. 品質スコア

| カテゴリ | スコア | 備考 |
|---------|--------|------|
| **ファイル構成** | 7/10 | Hugo標準に準拠、ただしビルド成果物がコミット |
| **コード重複** | 4/10 | 3箇所以上で重大な重複 |
| **命名の一貫性** | 7/10 | 概ね良好、軽微な不整合あり |
| **設定管理** | 5/10 | 重複キー、未使用パラメータ、ハードコード値 |
| **ドキュメント** | 2/10 | README、CONTRIBUTING、theme.toml がない |
| **再利用性** | 6/10 | パーシャルはパラメータ化済み、改善の余地あり |
| **パフォーマンス** | 7/10 | 画像最適化あり、一元化が必要 |
| **保守性** | 5/10 | 重複により変更コストが高い |

**総合スコア: 6.5/10**

---

## 6. まとめ

hugo-theme-hibi は、Tailwind v4、ダークモード対応、レスポンシブデザインなど、モダンなツールを活用した良好な基盤を持っています。

しかし、**ポストカードとページネーションの重複**が最大の保守性リスクです。この改善により、将来の変更コストを約60%削減できます。

優先的に対応すべき項目:
1. テンプレート重複の解消（高優先度）
2. 設定の一元化（高優先度）
3. ドキュメント整備（中優先度）

個人ブログ用途としては十分機能しますが、公開テーマやチーム開発での使用には、上記の構造改善が推奨されます。

---

## 関連ファイル

**テンプレート**:
- `layouts/_default/baseof.html`
- `layouts/_default/single.html`
- `layouts/_default/archive.html`
- `layouts/index.html`
- `layouts/partials/post-card.html`
- `layouts/partials/post-card-compact.html`
- `layouts/partials/pagination.html`

**設定**:
- `config.yaml`
- `tailwind.config.js`
- `netlify.toml`

**アセット**:
- `assets/css/main.css`
- `assets/js/search.js`
- `assets/js/theme.js`
- `assets/js/menu.js`

**過去の監査**:
- `20260117_reviw.md`（既存の内部監査レポート）
